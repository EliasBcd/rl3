---
title: "S√©ance 4 : Donn√©es tabulaires et graphiques avanc√©s"
subtitle: "Apprendre R avec les LLMs"
author: "Elias Bouacida"
date: last-modified
date-format: long
format:
  html: default
  revealjs:
    scrollable: true
    slide-number: true
    output-file: slide-lecon4.html
    embed-resources: true
    footer: "S√©ance 4 - Donn√©es tabulaires et graphiques avanc√©s"
format-links: [revealjs]
lang: fr
execute:
  echo: true
---

## Plan de la s√©ance {.smaller}

::: {.incremental}
- **R√©cap et partage** (15min) : Retours sur les fonctions
- **Nettoyage de donn√©es** (60min) : G√©rer les incoh√©rences r√©elles
- **Introduction √† ggplot2** (75min) : Cr√©er des graphiques sophistiqu√©s
- **Fonctions de visualisation** (40min) : Automatiser la cr√©ation de graphiques
- **Mini-projet** (40min) : Dashboard de visualisations
:::

::: {.fragment}
**Production attendue :** Dashboard avec 4 graphiques + fonction de visualisation r√©utilisable
:::

## Objectifs de la s√©ance

::: {.callout-tip}
## Ma√Ætriser les donn√©es complexes et la visualisation
:::

::: {.incremental}
- **Nettoyer** des donn√©es avec incoh√©rences (casse, formats)
- Ma√Ætriser les **dataframes** avanc√©s
- Cr√©er des **visualisations** avec `ggplot2`
- D√©velopper des **fonctions graphiques** r√©utilisables
- Combiner analyse et communication visuelle
:::

# R√©cap et partage {background-color="#2E8B57"}

## Retours sur les fonctions

::: {.incremental}
- Quelles fonctions avez-vous cr√©√©es ?
- Quelles difficult√©s avec les conditions et boucles ?
- Un exemple de bug int√©ressant que vous avez r√©solu ?
:::

## Exercice de r√©vision {.smaller}

**Cr√©ez rapidement une fonction qui :**

1. Prend un vecteur de nombres en param√®tre
2. Retourne "Positif" si la moyenne de ces nombres est > 0
3. Retourne "N√©gatif" sinon
4. G√®re les NA correctement

::: {.fragment}
**Testez avec :**

```{r}
#| eval: false
valeurs <- c(-5, 10, NA, 8, -3)
classifier_moyenne(valeurs)
```
:::

::: {.notes}
10 minutes. R√©vision rapide. V√©rifier que les concepts de la s√©ance 3 sont acquis.
:::

# Donn√©es r√©elles et leurs probl√®mes {background-color="#4169E1"}

## Les donn√©es ne sont jamais parfaites

Dans le monde r√©el, les donn√©es contiennent souvent :

::: {.incremental}
- Des **probl√®mes de casse** : "Alice", "alice", "ALICE"
- Des **formats incoh√©rents** : "2023-01-15", "15/01/2023"
- Des **valeurs manquantes** : NA, "", "N/A", "inconnu"
- Des **doublons**
- Des **erreurs de saisie**
:::

::: {.fragment}
::: {.callout-warning}
## Important
Le nettoyage des donn√©es repr√©sente souvent 80% du travail d'analyse !
:::
:::

## Exercice 1 : D√©couvrir les probl√®mes {.smaller}

**Voici un jeu de donn√©es de ventes :**

```{r}
#| eval: false
ventes <- data.frame(
  mois = c("Jan", "F√©v", "Mar", "Avr", "Mai", "Jun"),
  montant = c(1500, 2000, NA, 1800, 2200, 1900),
  vendeur = c("Alice", "Bob", "alice", "Bob", "Alice", "bob")
)
```

**Demandez au LLM :**

> "Quels sont les probl√®mes potentiels dans ce jeu de donn√©es pour une analyse ?"

::: {.fragment}
**Identifiez :**

1. Le probl√®me de casse dans les noms
2. La valeur manquante
3. Les cons√©quences pour les calculs par vendeur
:::

::: {.notes}
15 minutes. Les √©tudiants d√©couvrent les probl√®mes r√©els des donn√©es.
:::

## Exercice 2 : Nettoyer la casse {.smaller}

**Probl√®me :** Les noms "Alice", "alice" et "Bob", "bob" sont compt√©s s√©par√©ment.

**Demandez au LLM comment standardiser les noms.**

::: {.fragment}
Vous d√©couvrirez probablement :

```{r}
#| eval: false
ventes$vendeur <- tolower(ventes$vendeur)
# ou
ventes$vendeur <- toupper(ventes$vendeur)
```
:::

::: {.fragment}
**V√©rifiez le r√©sultat :**

```{r}
#| eval: false
unique(ventes$vendeur)
table(ventes$vendeur)
```
:::

::: {.notes}
15 minutes. Premier nettoyage simple mais essentiel.
:::

## Exercice 3 : G√©rer les valeurs manquantes {.smaller}

**Plusieurs strat√©gies possibles :**

**Demandez au LLM :**

> "Comment g√©rer les valeurs NA dans mes donn√©es de ventes ? Quelles sont les diff√©rentes approches ?"

::: {.fragment}
**Options principales :**

1. **Supprimer** les lignes avec NA : `na.omit()`
2. **Remplacer** par une valeur : moyenne, m√©diane, 0
3. **Garder** mais utiliser `na.rm = TRUE` dans les calculs
:::

::: {.fragment}
::: {.callout-note}
## R√©flexion importante
Quelle strat√©gie choisir d√©pend du contexte ! Supprimer des donn√©es peut introduire des biais.
:::
:::

::: {.notes}
15 minutes. Discussion importante sur les choix m√©thodologiques.
:::

## Exercice 4 : Jeu de donn√©es complexe pi√©g√© {.smaller}

**Nouveau challenge - Donn√©es √©tudiants :**

```{r}
#| eval: false
etudiants <- data.frame(
  nom = c("Dupont", "Martin", "Durand", "", "Petit"),
  age = c(20, "vingt-deux", 19, 21, 18),
  note_math = c(15, 12, NA, 16, 14),
  note_info = c(13, NA, 15, 12, 16),
  filiere = c("Info", "info", "Maths", "INFO", "maths")
)
```

**Mission :**

1. Identifiez TOUS les probl√®mes
2. Nettoyez le jeu de donn√©es
3. Calculez la moyenne par fili√®re

::: {.fragment}
**Utilisez le LLM √©tape par √©tape !**
:::

::: {.notes}
30 minutes. Exercice de synth√®se sur le nettoyage. Beaucoup d'erreurs √† trouver.
:::

# Introduction √† `ggplot2` {background-color="#FF8C00"}

## Pourquoi `ggplot2` ?

Jusqu'ici vous avez utilis√© `plot()`, `hist()`, `barplot()`...

::: {.fragment}
**ggplot2** est un package puissant pour cr√©er des graphiques :

- Syntaxe coh√©rente et logique
- Graphiques professionnels
- Tr√®s flexible et personnalisable
- Standard dans l'analyse de donn√©es en R
:::

## La grammaire des graphiques

**ggplot2** fonctionne par couches :

::: {.incremental}
1. **Donn√©es** : `ggplot(data = mes_donnees)`
2. **Esth√©tiques** : `aes(x = variable1, y = variable2)`
3. **G√©om√©tries** : `geom_point()`, `geom_line()`, `geom_bar()`
4. **Personnalisation** : titres, couleurs, th√®mes
:::

::: {.fragment}
On **ajoute** des couches avec `+`
:::

## Exercice 5 : Premier graphique ggplot2 {.smaller}

**Demandez au LLM :**

> "Comment cr√©er un graphique simple avec ggplot2 en R ? Je d√©bute avec ce package."

**Ensuite, testez avec vos donn√©es de ventes :**

```{r}
#| eval: false
library(ggplot2)

ggplot(data = ventes, aes(x = mois, y = montant)) +
  geom_col()
```

::: {.fragment}
**Questions :**

1. Que fait `aes()` ?
2. Pourquoi `geom_col()` et pas `geom_bar()` ?
3. Comment changer la couleur des barres ?
:::

::: {.notes}
20 minutes. Premi√®re d√©couverte de ggplot2. La syntaxe peut surprendre au d√©but.
:::

## Exercice 6 : Am√©liorer le graphique {.smaller}

**Personnalisez votre graphique :**

```{r}
#| eval: false
ggplot(data = ventes, aes(x = mois, y = montant)) +
  geom_col(fill = "steelblue") +
  labs(
    title = "Ventes mensuelles",
    x = "Mois",
    y = "Montant (‚Ç¨)"
  ) +
  theme_minimal()
```

::: {.fragment}
**Demandez au LLM :**

> "Comment personnaliser les couleurs, titres et th√®me d'un graphique ggplot2 ?"
:::

::: {.fragment}
**Explorez :**

- Diff√©rentes couleurs
- Diff√©rents th√®mes : `theme_bw()`, `theme_classic()`
- Ajout d'une ligne √† un niveau sp√©cifique avec `geom_hline()`
:::

::: {.notes}
20 minutes. Exploration des options de personnalisation.
:::

## Exercice 7 : Diff√©rents types de graphiques {.smaller}

**Demandez au LLM de vous montrer comment cr√©er :**

1. Un graphique en **points** (`geom_point()`)
2. Un graphique en **lignes** (`geom_line()`)
3. Un **boxplot** (`geom_boxplot()`)
4. Un **histogramme** (`geom_histogram()`)

::: {.fragment}
**Testez chaque type avec des donn√©es adapt√©es.**

Certains types n√©cessitent des donn√©es sp√©cifiques !
:::

::: {.notes}
20 minutes. D√©couverte de la vari√©t√© des g√©om√©tries disponibles.
:::

## Exercice 8 : Graphiques par cat√©gorie {.smaller}

**Challenge :** Cr√©ez un graphique des ventes color√© par vendeur.

**Demandez au LLM :**

> "Comment cr√©er un graphique avec ggplot2 o√π chaque cat√©gorie a une couleur diff√©rente ?"

::: {.fragment}
Vous d√©couvrirez :

```{r}
#| eval: false
ggplot(ventes, aes(x = mois, y = montant, fill = vendeur)) +
  geom_col(position = "dodge") +
  labs(title = "Ventes par vendeur et par mois")
```
:::

::: {.fragment}
**Questions :**

1. Que fait `position = "dodge"` ?
2. Que se passe-t-il sans ?
3. Comment faire un graphique empil√© ?
:::

::: {.notes}
20 minutes. Introduction aux graphiques multivari√©s.
:::

# Fonctions de visualisation {background-color="#8B008B"}

## Pourquoi cr√©er des fonctions graphiques ?

Si vous cr√©ez souvent le m√™me type de graphique :

::: {.incremental}
- √âviter la **r√©p√©tition** du code
- Garantir la **coh√©rence** visuelle
- Faciliter la **maintenance**
- Permettre la **r√©utilisation**
:::

## Exercice 9 : Premi√®re fonction graphique {.smaller}

**Cr√©ez une fonction qui g√©n√®re un graphique en barres standard :**

```{r}
#| eval: false
graphique_barres <- function(donnees, colonne_x, colonne_y, titre) {
  ggplot(donnees, aes(x = .data[[colonne_x]], y = .data[[colonne_y]])) +
    geom_col(fill = "steelblue") +
    labs(title = titre) +
    theme_minimal()
}

# Utilisation
graphique_barres(ventes, "mois", "montant", "Ventes mensuelles")
```

::: {.fragment}
**Demandez au LLM d'expliquer :**

1. √Ä quoi sert `.data[[...]]` ?
2. Comment passer des noms de colonnes comme param√®tres ?
:::

::: {.notes}
20 minutes. Introduction aux fonctions avec ggplot2. Concept avanc√© mais important.
:::

## Exercice 10 : Fonction graphique avanc√©e {.smaller}

**Am√©liorez votre fonction avec plus d'options :**

```{r}
#| eval: false
graphique_personnalise <- function(donnees, x, y, titre,
                                   couleur = "steelblue",
                                   type = "barres") {
  # Cr√©er le graphique de base
  g <- ggplot(donnees, aes(x = .data[[x]], y = .data[[y]]))

  # Ajouter la g√©om√©trie selon le type
  if (type == "barres") {
    g <- g + geom_col(fill = couleur)
  } else if (type == "points") {
    g <- g + geom_point(color = couleur, size = 3)
  }

  # Ajouter titre et th√®me
  g <- g + labs(title = titre) + theme_minimal()

  return(g)
}
```

::: {.fragment}
**Testez avec diff√©rentes options !**
:::

::: {.notes}
20 minutes. Fonction plus sophistiqu√©e avec options et conditions.
:::

# Mini-projet : Dashboard {background-color="#DC143C"}

## Projet : Analyse de ventes compl√®te {.smaller}

**Objectif :** Cr√©er un dashboard d'analyse avec 4 graphiques diff√©rents.

**Donn√©es :**

```{r}
#| eval: false
# T√©l√©chargez les fichiers de ventes mensuelles depuis Moodle
ventes_janvier <- read.csv("ventes_janvier.csv")
# etc
```

**Les 4 graphiques √† cr√©er :**

1. √âvolution des ventes mensuelles (ligne)
2. Ventes par r√©gion (barres)
3. Distribution des montants (histogramme)
4. Comparaison par r√©gion (boxplot)

::: {.callout-note}
## Utilisez `ggplot2` pour tous les graphiques
Personnalisez-les avec des couleurs et titres appropri√©s.
:::

::: {.notes}
40 minutes. Projet de synth√®se. Combine nettoyage, analyse et visualisation.
:::

## Crit√®res du mini-projet {.smaller}

::: {.incremental}
- Les donn√©es sont **nettoy√©es** (casse, NA g√©r√©s)
- Les 4 graphiques sont **cr√©√©s avec `ggplot2`**
- Chaque graphique a un **titre et des l√©gendes** appropri√©s
- Le code est **comment√©**
- Une **fonction de visualisation** r√©utilisable est cr√©√©e (facultatif)
:::

::: {.fragment}
**Bonus :**

- Cr√©er un 5^e^ graphique original
- Utiliser des facettes (`facet_wrap()`)
- Ajouter des annotations sur les graphiques
- Sauvegarder les graphiques avec `ggsave()`
:::

# Retour r√©flexif {background-color="#2F4F4F"}

## Exercice r√©flexif : Journal de bord {.smaller}

**Documentez dans votre journal :**

1. **Nettoyage de donn√©es** :
   - Quels probl√®mes avez-vous rencontr√©s ?
   - Comment les avez-vous r√©solus ?
   - Un prompt efficace pour le nettoyage

2. **ggplot2** :
   - Diff√©rences avec `plot()` de base
   - Votre graphique pr√©f√©r√© cr√©√© aujourd'hui
   - Un concept difficile √† comprendre

3. **Fonctions graphiques** :
   - Pourquoi cr√©er des fonctions pour les graphiques ?
   - Code de votre fonction r√©utilisable

::: {.notes}
10 minutes. Moment de r√©flexion et documentation.
:::

## Ce que vous avez appris aujourd'hui

::: {.incremental}
- Nettoyer des donn√©es r√©elles avec incoh√©rences
- Utiliser `ggplot2` pour cr√©er des graphiques professionnels
- Ma√Ætriser diff√©rentes g√©om√©tries (barres, points, lignes, boxplot)
- Personnaliser l'apparence des graphiques
- Cr√©er des fonctions de visualisation r√©utilisables
- Combiner analyse et communication visuelle
:::

# Ressources et prochaines √©tapes {background-color="#2E8B57"}

## Fonctions cl√©s de cette s√©ance

**Nettoyage :**

- `tolower()`, `toupper()` : standardiser la casse
- `na.omit()` : supprimer les NA
- `unique()`, `table()` : explorer les valeurs

**ggplot2 :**

- `ggplot()` + `aes()` : base du graphique
- `geom_col()`, `geom_point()`, `geom_line()` : g√©om√©tries
- `labs()` : titres et labels
- `theme_minimal()`, `theme_bw()` : th√®mes

## Pour aller plus loin

::: {.incremental}
- **Explorez** d'autres g√©om√©tries de ggplot2
- **Pratiquez** avec vos propres donn√©es
- **Cr√©ez** une biblioth√®que de fonctions graphiques
- **Consultez** la documentation : `?ggplot2`
:::

## Pr√©paration prochaine s√©ance

::: {.callout-note}
## Devoirs

1. Terminez le dashboard si besoin
2. **Mettez √† jour votre journal** avec les d√©tails de cette s√©ance
3. Trouvez un jeu de donn√©es qui vous int√©resse pour le projet de la s√©ance 5
4. Cr√©ez au moins 2 fonctions graphiques r√©utilisables
:::

::: {.fragment}
**Prochaine s√©ance :** Projet personnel int√©gr√© - vous allez mener une analyse compl√®te en autonomie !
:::

## Questions ?

::: {.callout-tip}
## Points cl√©s √† retenir

- Le **nettoyage** des donn√©es est essentiel et prend du temps
- **ggplot2** permet de cr√©er des graphiques professionnels de mani√®re coh√©rente
- Les **fonctions graphiques** √©vitent la r√©p√©tition et assurent la coh√©rence
- La **visualisation** est aussi importante que l'analyse
:::

::: {.fragment}
**Bon courage et belles visualisations ! üìä**
:::
