---
title: "Resultats étudiants"
author: "Elias"
format: html
execute: 
  cache: false
  warning: false
  echo: false
---

```{r import}
source("TreatResults.R")
library(tidyverse)

dir <-  "R-Exercices/"
a <- list.files(dir, pattern = ".")
b <- lapply(a, function(x) paste(dir, x, sep=""))
c <- sapply(b, decode_results)
```

```{r}
data <- NULL
failures <- c()
for (tab in c){
  if(is.data.frame(tab)){
    if(is.null(data)){
      data <- tab
    }
    else {
      tryCatch(data <- rbind(data, tab),
               error = function(e) cat("ERROR: ", conditionMessage(e), "\n"))
    }
  }
  else(
    failures <- c(failures, tab)
  )
}



```
Renommer les leçons correctement

```{r}
data <- data %>% 
  mutate(lesson_name = replace(lesson_name, lesson_name == "Vecteurs num<e9>riques", "Vecteurs numériques"),
         lesson_name = replace(lesson_name, lesson_name == "InitiationR", "Dataframes"))

```

Maximum par leçon

```{r}
nquestions <- data %>%
  group_by(lesson_name) %>% 
  summarise(max_all = max(question_number))

knitr::kable(nquestions)
```


```{r}
summary <- data %>%
  group_by(user, lesson_name) %>%
  filter(!(lesson_name == 'Types' | lesson_name == 'Assignations et objets' |lesson_name == 'Manipulations simples')) %>% 
  summarise(skip = mean(skipped, na.rm = TRUE), attempt = mean(attempt), max = (max(question_number))) %>% 
  inner_join(nquestions, by = "lesson_name") %>% 
  mutate(finished = (max/max_all), max = NULL, max_all = NULL, n())


  

knitr::kable(summary)
```

```{r}
failures
```


## Exploring weird data



