---
title: "S√©ance 6 : Organisation et modularit√©"
subtitle: "Apprendre R avec les LLMs"
author: "Elias Bouacida"
date: last-modified
date-format: long
format:
  html: default
  revealjs:
    scrollable: true
    slide-number: true
    output-file: slide-lecon6.html
    embed-resources: true
    footer: "S√©ance 6 - Organisation et modularit√©"
format-links: [revealjs]
lang: fr
execute:
  echo: true
---

## Plan de la s√©ance {.smaller}

::: {.incremental}
- **R√©cap et partage** (15min) : Retours sur les projets
- **Refactoring collectif** (45min) : Organiser un long script
- **Packages et √©cosyst√®me R** (60min) : dplyr, lubridate, stringr
- **Gestion des erreurs courantes** (45min) : Packages manquants, conflits
- **Mini-package personnel** (50min) : Organiser ses fonctions
:::

::: {.fragment}
**Production attendue :** Code organis√© en modules + ma√Ætrise de 3 packages
:::

## Objectifs de la s√©ance

::: {.callout-tip}
## Structurer son code comme un professionnel
:::

::: {.incremental}
- **Organiser** son code en modules logiques
- **D√©couvrir** l'√©cosyst√®me des packages R
- **Ma√Ætriser** dplyr pour manipuler les donn√©es
- **G√©rer** les erreurs li√©es aux packages
- **Cr√©er** sa propre biblioth√®que de fonctions
:::

# R√©cap et partage {background-color="#2E8B57"}

## Retours sur vos projets

::: {.incremental}
- Quels retours avez-vous re√ßus ?
- Qu'avez-vous am√©lior√© dans votre projet ?
- Une difficult√© commune que vous avez observ√©e ?
:::

## Le probl√®me du code "spaghetti"

**Observez ce type de code :**

```{r}
#| eval: false
# 500 lignes de code dans un seul fichier...
donnees <- read.csv("data.csv")
donnees$nom <- tolower(donnees$nom)
# ... 50 lignes de nettoyage ...
moyenne1 <- mean(donnees$valeur1, na.rm = TRUE)
# ... 30 lignes de calculs ...
ggplot(donnees, aes(x = var1, y = var2)) + geom_point()
# ... encore 400 lignes ...
```

::: {.fragment}
::: {.callout-warning}
## Probl√®mes
- Difficile √† lire
- Difficile √† maintenir
- Impossible √† r√©utiliser
- Difficile √† d√©bugger
:::
:::

# Refactoring collectif {background-color="#4169E1"}

## Qu'est-ce que le refactoring ?

**Refactoring** = R√©organiser le code sans changer son comportement

::: {.incremental}
**Objectifs :**

- Am√©liorer la **lisibilit√©**
- Faciliter la **r√©utilisation**
- Simplifier la **maintenance**
- R√©duire la **duplication**
:::

## Exercice 1 : Analyser du code d√©sordonn√© {.smaller}

**Voici un script √† am√©liorer :**

```{r}
#| eval: false
d <- read.csv("ventes.csv")
d$nom <- tolower(d$nom)
d$date <- as.Date(d$date)
m <- mean(d$montant, na.rm = TRUE)
print(paste("Moyenne:", m))
d2 <- d[d$montant > m, ]
plot(d2$date, d2$montant)
s <- sum(d$montant, na.rm = TRUE)
print(paste("Total:", s))
d3 <- d[d$categorie == "A", ]
m2 <- mean(d3$montant, na.rm = TRUE)
```

**Demandez au LLM :**

> "Quels sont les probl√®mes de ce code ? Comment pourrait-on l'am√©liorer ?"

::: {.notes}
15 minutes. Discussion collective sur les probl√®mes.
:::

## Principes d'organisation

::: {.incremental}
1. **Un fichier = une responsabilit√©**
   - `01_import_donnees.R`
   - `02_nettoyage.R`
   - `03_fonctions_analyse.R`
   - `04_visualisation.R`

2. **Des noms explicites**
   - `calculer_moyenne_par_groupe()` ‚úÖ
   - `calc()` ‚ùå

3. **Des fonctions courtes**
   - Une fonction = une t√¢che

4. **Des commentaires utiles**
   - Expliquer le "pourquoi", pas le "quoi"
:::

## Exercice 2 : Refactoring guid√© {.smaller}

**Transformons le code pr√©c√©dent ensemble :**

**√âtape 1 - Fonctions de nettoyage :**

```{r}
#| eval: false
nettoyer_noms <- function(data) {
  data$nom <- tolower(data$nom)
  return(data)
}

convertir_dates <- function(data, colonne_date) {
  data[[colonne_date]] <- as.Date(data[[colonne_date]])
  return(data)
}
```

**√âtape 2 - Fonctions d'analyse :**

```{r}
#| eval: false
calculer_statistiques <- function(data, colonne) {
  list(
    moyenne = mean(data[[colonne]], na.rm = TRUE),
    total = sum(data[[colonne]], na.rm = TRUE),
    n = length(data[[colonne]])
  )
}
```

::: {.notes}
20 minutes. Refactoring collectif guid√©.
:::

## Exercice 3 : Organisation en modules {.smaller}

**Cr√©ez la structure suivante :**

```
mon_projet/
‚îú‚îÄ‚îÄ donnees/
‚îÇ   ‚îî‚îÄ‚îÄ ventes.csv
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ 01_fonctions_nettoyage.R
‚îÇ   ‚îú‚îÄ‚îÄ 02_fonctions_analyse.R
‚îÇ   ‚îî‚îÄ‚îÄ 03_fonctions_visualisation.R
‚îî‚îÄ‚îÄ analyse_principale.R
```

**Dans `analyse_principale.R` :**

```{r}
#| eval: false
# Charger les fonctions
source("scripts/01_fonctions_nettoyage.R")
source("scripts/02_fonctions_analyse.R")
source("scripts/03_fonctions_visualisation.R")

# Utiliser les fonctions
donnees <- read.csv("donnees/ventes.csv")
donnees <- nettoyer_noms(donnees)
stats <- calculer_statistiques(donnees, "montant")
```

::: {.notes}
20 minutes. Les √©tudiants cr√©ent leur premi√®re structure modulaire.
:::

# Packages et √©cosyst√®me R {background-color="#FF8C00"}

## Qu'est-ce qu'un package ?

Un **package** = Collection de fonctions r√©utilisables

::: {.incremental}
**Avantages :**

- Fonctions **test√©es** et **document√©es**
- **Gain de temps** √©norme
- **Communaut√©** active
- **Standards** professionnels
:::

::: {.fragment}
**Exemples c√©l√®bres :**

- `ggplot2` : graphiques (vous connaissez d√©j√† !)
- `dplyr` : manipulation de donn√©es
- `tidyr` : restructuration de donn√©es
- `lubridate` : dates et heures
:::

## Installer et charger un package

**Installation (une seule fois) :**

```{r}
#| eval: false
install.packages("dplyr")
```

**Chargement (√† chaque session) :**

```{r}
#| eval: false
library(dplyr)
```

::: {.fragment}
::: {.callout-note}
## Important
`install.packages()` : t√©l√©charge depuis internet
`library()` : active pour utilisation
:::
:::

## Exercice 4 : D√©couvrir dplyr {.smaller}

**dplyr simplifie la manipulation de donn√©es**

**Demandez au LLM :**

> "Explique-moi les principales fonctions de dplyr en R avec des exemples simples"

::: {.fragment}
**Fonctions principales :**

- `filter()` : filtrer les lignes
- `select()` : s√©lectionner les colonnes
- `mutate()` : cr√©er/modifier des colonnes
- `summarise()` : calculer des r√©sum√©s
- `group_by()` : grouper par cat√©gorie
- `arrange()` : trier les lignes
:::

::: {.fragment}
**Testez avec vos donn√©es !**
:::

::: {.notes}
20 minutes. Premi√®re d√©couverte de dplyr.
:::

## Le pipe `%>%` (ou `|>`)

**dplyr introduit le pipe pour cha√Æner les op√©rations :**

```{r}
#| eval: false
# Ancienne m√©thode (difficile √† lire)
resultat <- arrange(
  summarise(
    group_by(
      filter(donnees, age > 18),
      categorie
    ),
    moyenne = mean(valeur)
  ),
  moyenne
)

# Avec le pipe (facile √† lire)
resultat <- donnees %>%
  filter(age > 18) %>%
  group_by(categorie) %>%
  summarise(moyenne = mean(valeur)) %>%
  arrange(moyenne)
```

::: {.fragment}
**Le pipe se lit comme : "puis"**
:::

## Exercice 5 : Pratiquer dplyr {.smaller}

**Avec un dataset de ventes, utilisez dplyr pour :**

```{r}
#| eval: false
library(dplyr)

ventes %>%
  filter(montant > 1000) %>%          # Garder montants > 1000
  select(vendeur, montant, date) %>%  # S√©lectionner colonnes
  mutate(montant_ttc = montant * 1.2) %>%  # Ajouter TVA
  group_by(vendeur) %>%               # Grouper par vendeur
  summarise(
    total = sum(montant_ttc),
    moyenne = mean(montant_ttc),
    n_ventes = n()
  ) %>%
  arrange(desc(total))                # Trier par total d√©croissant
```

**Demandez au LLM d'expliquer chaque ligne si besoin !**

::: {.notes}
20 minutes. Exercice pratique avec dplyr.
:::

## Exercice 6 : Autres packages utiles {.smaller}

**D√©couvrez d'autres packages :**

**lubridate (dates) :**

```{r}
#| eval: false
library(lubridate)

date <- "2023-01-15"
d <- ymd(date)
year(d)   # Extraire l'ann√©e
month(d)  # Extraire le mois
wday(d, label = TRUE)  # Jour de la semaine
```

**stringr (texte) :**

```{r}
#| eval: false
library(stringr)

texte <- "  Bonjour  "
str_trim(texte)        # Enlever espaces
str_to_upper(texte)    # Majuscules
str_detect(texte, "Bon")  # D√©tecter motif
```

**Demandez au LLM des exemples pour chaque package !**

::: {.notes}
20 minutes. D√©couverte d'autres packages utiles.
:::

# Gestion des erreurs {background-color="#8B008B"}

## Erreurs courantes avec les packages

::: {.incremental}
**1. Package non install√© :**

```
Error: could not find function "filter"
‚Üí Avez-vous fait install.packages("dplyr") ?
```

**2. Package non charg√© :**

```
Error: could not find function "filter"
‚Üí Avez-vous fait library(dplyr) ?
```

**3. Conflits de noms :**

```
filter() existe dans dplyr ET dans stats
‚Üí Utiliser dplyr::filter() pour √™tre explicite
```

**4. Versions incompatibles :**

```
Le package n√©cessite R version 4.0 minimum
‚Üí Mettre √† jour R
```
:::

## Exercice 7 : Debugging de packages {.smaller}

**Corrigez ces erreurs volontaires :**

```{r}
#| eval: false
# Probl√®me 1
donnees %>%
  filter(age > 18)
# Erreur: could not find function "%>%"

# Probl√®me 2
library(dplyr)
select(iris, Species, Sepal.Length)
# Marche, mais warning sur conflit avec MASS

# Probl√®me 3
install.packages("monpackageinexistant")
# Erreur: package not found
```

**Demandez au LLM de vous aider √† comprendre et r√©soudre chaque erreur.**

::: {.notes}
15 minutes. Exercice de debugging.
:::

## Bonnes pratiques

::: {.incremental}
**Au d√©but de chaque script :**

```{r}
#| eval: false
# Charger les packages n√©cessaires
library(dplyr)
library(ggplot2)
library(lubridate)

# V√©rifier la version R si besoin
if (getRversion() < "4.0.0") {
  stop("Ce script n√©cessite R version 4.0 ou sup√©rieure")
}
```

**En cas de conflit :**

```{r}
#| eval: false
# Sp√©cifier explicitement le package
dplyr::filter(donnees, age > 18)
stats::filter(serie_temporelle, filtre)
```
:::

# Mini-package personnel {background-color="#DC143C"}

## Projet : Organiser vos fonctions

**Objectif :** Cr√©er une biblioth√®que personnelle de fonctions r√©utilisables

**Structure :**

```
ma_bibliotheque/
‚îú‚îÄ‚îÄ nettoyage.R
‚îú‚îÄ‚îÄ analyse.R
‚îú‚îÄ‚îÄ visualisation.R
‚îî‚îÄ‚îÄ utils.R
```

## Exercice 8 : Cr√©er sa biblioth√®que {.smaller}

**Dans `nettoyage.R` :**

```{r}
#| eval: false
#' Standardiser les noms en minuscules
#' @param data Un dataframe
#' @param colonne Nom de la colonne √† nettoyer
#' @return Le dataframe avec la colonne nettoy√©e
standardiser_noms <- function(data, colonne) {
  data[[colonne]] <- tolower(data[[colonne]])
  return(data)
}

#' Supprimer les lignes avec NA
supprimer_na <- function(data, colonnes = NULL) {
  if (is.null(colonnes)) {
    return(na.omit(data))
  }
  data[complete.cases(data[, colonnes]), ]
}
```

**Cr√©ez au moins 3 fonctions dans chaque fichier !**

::: {.notes}
30 minutes. Les √©tudiants organisent leurs fonctions.
:::

## Documentation des fonctions

**Utilisez les commentaires roxygen2 :**

```{r}
#| eval: false
#' Titre court de la fonction
#'
#' Description d√©taill√©e de ce que fait la fonction.
#'
#' @param parametre1 Description du premier param√®tre
#' @param parametre2 Description du second param√®tre
#' @return Description de ce que retourne la fonction
#' @examples
#' ma_fonction(donnees, "colonne")
ma_fonction <- function(parametre1, parametre2) {
  # Code ici
}
```

::: {.fragment}
**Demandez au LLM de vous aider √† documenter vos fonctions !**
:::

## Exercice 9 : Utiliser sa biblioth√®que {.smaller}

**Cr√©ez un script principal qui utilise votre biblioth√®que :**

```{r}
#| eval: false
# Charger toutes vos fonctions
source("ma_bibliotheque/nettoyage.R")
source("ma_bibliotheque/analyse.R")
source("ma_bibliotheque/visualisation.R")

# Utiliser vos fonctions
donnees <- read.csv("data.csv")
donnees <- standardiser_noms(donnees, "nom")
donnees <- supprimer_na(donnees, c("age", "salaire"))

stats <- calculer_statistiques_complete(donnees)
plot_distribution(donnees, "salaire")
```

**Testez que tout fonctionne !**

::: {.notes}
20 minutes. Test d'int√©gration.
:::

# Retour r√©flexif {background-color="#2F4F4F"}

## Exercice r√©flexif : Journal de bord {.smaller}

**Documentez :**

1. **Refactoring** :
   - Avant/apr√®s : montrez un exemple de code que vous avez am√©lior√©
   - Qu'est-ce qui rend le code "apr√®s" meilleur ?

2. **Packages** :
   - Les 3 packages d√©couverts aujourd'hui
   - Fonction la plus utile de chaque package
   - Une erreur de package que vous avez r√©solue

3. **Organisation** :
   - Structure de votre biblioth√®que personnelle
   - Vos fonctions les plus r√©utilisables
   - Comment cette organisation vous aidera

::: {.notes}
15 minutes. Documentation des apprentissages.
:::

## Ce que vous avez appris

::: {.incremental}
‚úÖ Organiser son code en modules logiques
‚úÖ Cr√©er et documenter des fonctions r√©utilisables
‚úÖ Utiliser dplyr pour manipuler les donn√©es
‚úÖ D√©couvrir l'√©cosyst√®me des packages R
‚úÖ G√©rer les erreurs li√©es aux packages
‚úÖ Cr√©er sa propre biblioth√®que de fonctions
‚úÖ Adopter les bonnes pratiques professionnelles
:::

# Ressources et prochaines √©tapes {background-color="#2E8B57"}

## Packages cl√©s d√©couverts

**dplyr :**

- `filter()`, `select()`, `mutate()`, `summarise()`, `group_by()`
- Le pipe `%>%` (ou `|>`)

**lubridate :**

- `ymd()`, `year()`, `month()`, `wday()`

**stringr :**

- `str_trim()`, `str_to_upper()`, `str_detect()`

## Pour aller plus loin

::: {.incremental}
- **Explorez** d'autres packages du tidyverse
- **Organisez** vos anciens projets avec cette nouvelle structure
- **Documentez** syst√©matiquement vos fonctions
- **Partagez** vos fonctions avec vos camarades
:::

## Pr√©paration prochaine s√©ance

::: {.callout-note}
## Devoirs

1. R√©organisez un de vos anciens projets avec la structure modulaire
2. Cr√©ez au moins 5 fonctions document√©es dans votre biblioth√®que
3. Pratiquez dplyr avec vos propres donn√©es
4. **Mettez √† jour votre journal** avec tous les d√©tails
:::

::: {.fragment}
**Prochaine s√©ance :** Automatisation et rapports - traiter plusieurs fichiers et cr√©er des rapports reproductibles !
:::

## Questions ?

::: {.callout-tip}
## Points cl√©s √† retenir

- Le **code organis√©** est plus facile √† maintenir et r√©utiliser
- Les **packages** vous font gagner un temps pr√©cieux
- **dplyr** est essentiel pour manipuler des donn√©es
- **Documenter** ses fonctions est une bonne pratique
- La **modularit√©** est la cl√© du code professionnel
:::

::: {.fragment}
**Bon courage pour l'organisation ! üìö**
:::