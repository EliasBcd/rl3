<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Une introduction à R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Élias Bouacida ; Antoine Terracol" />
    <meta name="date" content="2022-07-22" />
    <script src="slidesrl3_files/header-attrs/header-attrs.js"></script>
    <link href="slidesrl3_files/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="style_perso.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Une introduction à R
]
.subtitle[
## L3 économie-finance
]
.author[
### Élias Bouacida ; Antoine Terracol
]
.institute[
### Université Paris 8
]
.date[
### 2022-07-22
]

---





---
class: left, top
name: Introduction

# Qu'est-ce que R ?

- R est un langage de programmation tourné principalement vers l'analyse des données et les statistiques. [Wikipédia](https://fr.wikipedia.org/wiki/R_(langage))
- Dérive d'un langage antérieur appelé S [Wikipédia](https://fr.wikipedia.org/wiki/S_(langage))
- R est un logiciel libre

---
name: objectif
# Objectif du cours

- Apprendre à utiliser R et Rstudio
- Apprendre à utiliser les principales librairies de R
- Vous préparez à utiliser R dans d'autres cours

---
class: left, top
name: Installation

# Installation

Le seul prérequis pour suivre ce cours est d'avoir installé R et RStudio sur votre ordinateur.

Il s'agit de deux logiciels libres, gratuits, téléchargeables en ligne et fonctionnant sous Windows, Mac et Linux.

Pour installer R, il suffit de se rendre sur une des pages suivantes :

- [Installer R sous Windows](https://cloud.r-project.org/bin/windows/base/)
- [Installer R sous Mac](https://cloud.r-project.org/bin/macosx/)
- Pour l'installer sous Linux, vous pouvez utiliser le gestionnaire de paquet ou bien suivre les instructions [ici](https://cran.r-project.org/bin/linux/ubuntu/) (pour Ubuntu/Debian)

Pour installer RStudio, rendez-vous sur [la page de téléchargement du logiciel](https://www.rstudio.com/products/rstudio/download/#download) et installez la version (gratuite) adaptée à votre système.

Vous pouvez aussi utiliser la version en ligne [Rstudio.cloud](https://rstudio.cloud/), qui est très similaire à Rstudio.

Vous trouverez plus d'informations sur l'installation de R et Rstudio sur le page Moodle du cours.


---
class:inverse
# Prise en main

---
class: left, top


## La console

Au premier lancement de RStudio, l'interface est organisée en trois grandes zones.

&lt;img src="fenetreRStudio.png" width="600px" /&gt;



La zone de gauche se nomme la Console. 
À son démarrage, RStudio a lancé une nouvelle session de R et c'est dans cette fenêtre que nous allons pouvoir interagir avec lui.

---
La première chose à faire est d'installer le paquet `swirl`.
Pour cela, copié-collé les lignes suivantes dans la console :

```r
library(swirl)
swirl::select_language("french", append_rprofile = T)
```

Et de télécharger une leçon

---
La Console affiche un texte de bienvenue suivi d'une ligne commençant par le caractère `&gt;` (l'invite de commande). 


Nous pouvons tout de suite essayer quelques calculs :


```r
2+2
```

```
## [1] 4
```
--


```r
5-7
```

```
## [1] -2
```

```r
4*12
```

```
## [1] 48
```

```r
-10/3
```

```
## [1] -3.333333
```

```r
5^2
```

```
## [1] 25
```

---
## Calculs de base




#### Addition, Sousraction, Multiplication et Division

| Math          | code `R`    | Résultat    |
|:-------------:|:-------:|:---------:|
| `\(3 + 2\)`       | `3 + 2` | 5 |
| `\(3 - 2\)`       | `3 - 2` | 1 |
| `\(3 \times 2\)`    | `3 * 2` | 6 |
| `\(3 \div 2\)`       | `3 / 2` | 1.5 |

#### Exposants

| Math          | code `R`    | Résultat    |
|:-------------:|:-------:|:---------:|
| `\(3^2\)`        | `3 ^ 2`         | 9         |
| `\(2^{(-3)}\)`   | `2 ^ (-3)`      | 0.125      |
| `\(100^{1/2}\)`  | `100 ^ (1 / 2)` | 10 |
| `\(\sqrt{100}\)` | `sqrt(100)`     | 10     |

---

#### Constantes mathématiques 

| Math          | code `R`    | Résultat    |
|:------------:|:---------------:|:-----------------:|
| `\(\pi\)`        | `pi`            | `3.141593`            |
| `\(e\)`          | `exp(1)`        | `2.718282`        |

#### Logarithmes

Il n'y a pas de `ln()` dans `R`, mais on utilise `log()` pour désigner le logarithme naturel. `log10()` désigne le logarithme en base 10

| Math          | code `R`    | Résultat    |
|:------------:|:---------------:|:-----------------:|
| `\(\ln(e)\)`         | `log(exp(1))`       | `1`       |
| `\(\log_{10}(1000)\)` | `log10(1000)`       | `3`       |

#### Trigonometrie

| Math          | code `R`    | Résultat    |
|:------------:|:---------------:|:-----------------:|
| `\(\sin(\pi / 2)\)` | `sin(pi / 2)` | `1` |
| `\(\cos(0)\)`       | `cos(0)`      | `1`      |


---

## Objets 

Pour conserver le résultat d'une opération, on peut le stocker dans un objet à l'aide de l'opérateur d'assignation `&lt;-`. Cette “flèche” stocke ce qu'il y a à sa droite dans un objet dont le nom est indiqué à sa gauche.


```r
x &lt;- 2
```
Se lit “prend la valeur 2 et mets la dans un objet qui s'appelle `x`”.

--
Si on exécute une commande comportant juste le nom d'un objet, `R` affiche son contenu


```r
x
```

```
## [1] 2
```
--

On peut évidemment réutiliser cet objet dans d'autres opérations : `R` le remplacera alors par sa valeur.

```r
x+4
```

```
## [1] 6
```

---
On peut créer autant d'objets qu'on le souhaite.


```r
x &lt;- 2
y &lt;- 5
resultat &lt;- x + y
resultat
```

```
## [1] 7
```
--

Si on assigne une nouvelle valeur à un objet, la valeur précédente est perdue.


```r
x &lt;- 2
x &lt;- 5
x
```

```
## [1] 5
```
--
Assigner un objet à un autre  copie juste la valeur de l'objet de droite dans celui de gauche


```r
x &lt;- 1
y &lt;- 3
x &lt;- y
x
```

```
## [1] 3
```

---

Les objets peuvent contenir tout un tas d'informations.

Jusqu'ici on n'a stocké que des nombres, mais ils peuvent aussi contenir des chaînes de caractères (du texte), qu'on délimite avec des guillemets simples ou doubles (' ou ") :


```r
chien &lt;- "Chihuahua"
chien
```

```
## [1] "Chihuahua"
```

--

Ou encore des conditions logiques (`TRUE` ou `FALSE`) basées sur des comparaisons


```r
valeur &lt;- TRUE
valeur
```

```
## [1] TRUE
```

```r
chien == "Doberman"
```

```
## [1] FALSE
```

```r
3&lt;2
```

```
## [1] FALSE
```

---
### Opérateurs logiques

| Opérateur | Résumé | Exemple | Résultat |
|:---------|:---------------------:|:---------------------:|:-------:|
| `x &lt; y`  | `x` plus petit que `y`                | `3 &lt; 42`               | TRUE               |
| `x &gt; y`  | `x` plus grand que `y`             | `3 &gt; 42`               | FALSE               |
| `x &lt;= y` | `x` plus petit ou égal à `y`    | `3 &lt;= 42`              | TRUE              |
| `x &gt;= y` | `x` plus grand ou égal à `y` | `3 &gt;= 42`              | FALSE              |
| `x == y` | `x` égal à `y`                  | `3 == 42`              | FALSE              |
| `x != y` | `x` pas égal à `y`             | `3 != 42`              | TRUE              |
| `!x`     | pas `x`                          | `!(3 &gt; 42)`            | TRUE            |
| &lt;code&gt;x &amp;#124; y&lt;/code&gt;  | `x` ou `y`     | &lt;code&gt;(3 &gt; 42) &amp;#124; TRUE&lt;/code&gt;      | TRUE      |
| `x &amp; y`  | `x` et `y`                      | `(3 &lt; 4) &amp; ( 42 &gt; 13)` | TRUE |



---

## Vecteurs

Imaginons qu'on a demandé la taille en centimètres de 5 personnes et qu'on souhaite calculer leur taille moyenne.

On pourrait créer autant d'objets que de tailles et calculer la moyenne


```r
taille1 &lt;- 156
taille2 &lt;- 164
taille3 &lt;- 197
taille4 &lt;- 147
taille5 &lt;- 173
(taille1 + taille2 + taille3 + taille4 + taille5) / 5
```

```
## [1] 167.4
```

--
Ce n’est clairement pas pratique du tout. On va plutôt stocker l'ensemble de nos tailles dans un seul objet, un vecteur, avec la syntaxe suivante :


```r
tailles &lt;- c(156, 164, 197, 147, 173)
```

où le `c()` veut dire "combine les valeurs suivantes dans un vecteur ou une liste"

---
Si on affiche le contenu de cet objet, on voit qu’il contient bien l’ensemble des tailles saisies.


```r
tailles
```

```
## [1] 156 164 197 147 173
```

--
Si on applique une opération à un vecteur, celle-ci s'applique à toutes les valeurs qu'il contient. 

Si on veut la taille en mètres plutôt qu'en centimètres, on peut faire :

```r
tailles_m &lt;- tailles/100
tailles_m
```

```
## [1] 1.56 1.64 1.97 1.47 1.73
```

---
Imaginons maintenant qu’on a aussi demandé aux cinq mêmes personnes leur poids en kilos.

On peut créer un deuxième vecteur :


```r
poids &lt;- c(45, 59, 110, 44, 88)
```

On peut alors effectuer des calculs utilisant nos deux vecteurs `tailles` et `poids`.

On peut par exemple calculer l’indice de masse corporelle (IMC) de chacun de nos enquêtés en divisant leur poids en kilo par leur taille en mètre au carré :

```r
imc &lt;- poids / (tailles / 100) ^ 2
imc
```

```
## [1] 18.49112 21.93635 28.34394 20.36189 29.40292
```

---

Un vecteur peut contenir des nombres, mais il peut aussi contenir du texte.

Imaginons qu'on a demandé aux 5 mêmes personnes leur type de chien préféré : on peut regrouper l'information dans un vecteur.


```r
chiens_pref &lt;-c("Doberman","Chihuahua","Husky","Bouvier Bernois","Labrador")
chiens_pref
```

```
## [1] "Doberman"        "Chihuahua"       "Husky"           "Bouvier Bernois" "Labrador"
```

--
Notons qu'on peut tester l'égalité des éléments d'un vecteur et d'un objet


```r
chiens_pref==chien
```

```
## [1] FALSE  TRUE FALSE FALSE FALSE
```

```r
tailles==147
```

```
## [1] FALSE FALSE FALSE  TRUE FALSE
```

```r
tailles_m&gt;1.6
```

```
## [1] FALSE  TRUE  TRUE FALSE  TRUE
```



---

L'opérateur `:` permet de générer rapidement un vecteur comprenant tous les nombres entre deux valeurs, opération assez courante sous R :


```r
liste &lt;- 1:10
liste
```

```
##  [1]  1  2  3  4  5  6  7  8  9 10
```

```r
liste2 &lt;- 10:1
liste2
```

```
##  [1] 10  9  8  7  6  5  4  3  2  1
```

--

Si nous voulons créer une séquence qui ne soit pas limitée aux nombres entiers et qui augmente de 1 à la fois, nous pouvons utiliser la fonction `seq()`.

```r
seq(from = 1.5, to = 2.2, by = 0.1)
```

```
## [1] 1.5 1.6 1.7 1.8 1.9 2.0 2.1 2.2
```

---
### Sous vecteurs

Pour extraire un sous-vecteur (subsetting), c'est-à-dire pour n'en choisir que certains éléments, nous utilisons des crochets, “`[]`”. Par exemple, `x[1]` renvoie le premier élément du vecteur `x`, et `x[3]` renvoie le troisième élément


```r
tailles
```

```
## [1] 156 164 197 147 173
```

```r
tailles[1]
```

```
## [1] 156
```

```r
tailles[3]
```

```
## [1] 197
```

--

Nous pouvons également exclure certains indices, en les faisant précéder par un signe `-` .

```r
tailles[-2]
```

```
## [1] 156 197 147 173
```

---

Enfin, on peut faire des sous-ensembles sur la base d'un vecteur d'indices.


```r
tailles[1:3]
```

```
## [1] 156 164 197
```

```r
tailles[c(1,3,4)]
```

```
## [1] 156 197 147
```


Nous pourrions également utiliser un vecteur de valeurs logiques.


```r
z = c(TRUE, TRUE, FALSE, TRUE, FALSE)
tailles[z]
```

```
## [1] 156 164 147
```

Ce qui est très pratique pour extraire un sous-vecteur des entrées respectant une condition logique : 

```r
tailles[tailles&gt;160]
```

```
## [1] 164 197 173
```
---

## Bases de données

Dans R, les bases de données sont des `data.frame`. Dans une `data.frame`, chaque .red[variable] est stockée comme une colonne, et chaque ligne est une .red[observation].

Pour créer une `data.frame`, on utilise la commande `data.frame()` :

```r
base &lt;- data.frame(tailles, poids)
```

Il est possible d'avoir plusieurs bases de données ouvertes simultanément dans une session R. Pour se référer à une variable particulière d'une base, on utilise la syntaxe  `&lt;nom de la base&gt;$&lt;nom de la variable&gt;`


```r
mean(base$tailles)
```

```
## [1] 167.4
```

```r
range(base$poids)
```

```
## [1]  44 110
```

Si on veut ajouter une variable à une base de données, on utilise la même syntaxe


```r
base$imc &lt;- base$poids/(base$taille/100)^2
```


---

## Fonctions

### Principes

Nous savons effectuer des opérations de base sur des nombres et des vecteurs, et stocker des valeurs dans des objets pour pouvoir les réutiliser plus tard.

Pour aller plus loin, nous devons aborder les fonctions qui sont, avec les objets, un deuxième concept de base de R. On utilise des fonctions pour effectuer des calculs, obtenir des résultats et accomplir des actions.

Formellement, une fonction a un nom, elle prend en entrée entre parenthèses un ou plusieurs arguments (ou paramètres), et retourne un résultat.

Prenons tout de suite un exemple. Si on veut connaître le nombre d'éléments du vecteur `tailles` que nous avons construit précédemment, on peut utiliser la fonction `length()`, de cette manière :

```r
length(tailles)
```

```
## [1] 5
```

---

Ici, `length()` est  la fonction, on l'appelle en lui passant un argument entre parenthèses (ici notre vecteur tailles), et elle nous renvoie un résultat, à savoir le nombre d'éléments du vecteur passé en paramètre.

Autre exemple, les fonctions `min()` et `max()` retournent respectivement les valeurs minimales et maximales d’un vecteur de nombres.


```r
min(tailles)
```

```
## [1] 147
```

```r
max(tailles)
```

```
## [1] 197
```
La fonction `mean()` calcule et retourne la moyenne d'un vecteur de nombres.


```r
mean(tailles)
```

```
## [1] 167.4
```

Une fonction peut renvoyer d'autres types de résultats. Par exemple, la fonction `range()` (étendue) renvoie un vecteur de deux nombres, le minimum et le maximum.


```r
range(tailles)
```

```
## [1] 147 197
```

---

### Arguments

Une fonction peut prendre plusieurs arguments, dans ce cas on les indique entre parenthèses en les séparant par des virgules.

On a déjà rencontré un exemple de fonction acceptant plusieurs arguments : la fonction `c()`, qui combine l'ensemble de ses arguments en un vecteur

```r
tailles &lt;- c(156,164,197,147,173)
```
Ici, `c()` est appelée en lui passant cinq arguments, les cinq tailles séparées par des virgules, et elle renvoie un vecteur numérique regroupant ces cinq valeurs.

Supposons maintenant que dans notre vecteur tailles nous avons une valeur manquante (une personne a refusé de répondre, ou notre mètre mesureur était en panne). On symbolise celle-ci dans R avec le code interne `NA`.


```r
tailles &lt;- c(156, 164, 197, NA, 173)
tailles
```

```
## [1] 156 164 197  NA 173
```

---

### Valeurs manquantes

Si on calcule maintenant la taille moyenne à l'aide de la fonction `mean()`, on obtient :

```r
mean(tailles)
```

```
## [1] NA
```

En effet, R considère par défaut qu’il ne peut pas calculer la moyenne si une des valeurs n’est pas disponible. Dans ce cas il considère que la moyenne est elle-même “non disponible” et renvoie donc `NA` comme résultat.

On peut cependant indiquer à `mean()` d'effectuer le calcul en ignorant les valeurs manquantes. Ceci se fait en ajoutant un argument supplémentaire, nommé `na.rm` (abbréviation de NA remove, “enlever les NA”), et de lui attribuer la valeur `TRUE`.


```r
mean(tailles, na.rm = TRUE)
```

```
## [1] 172.5
```

Mettre le paramètre `na.rm` à `TRUE` indique à la fonction `mean()` de ne pas tenir compte des valeurs manquantes dans le calcul.


---

### Aide sur une fonction

Il est fréquent de ne pas savoir (ou d'avoir oublié) quels sont les arguments d'une fonction, ou comment ils se nomment. On peut à tout moment faire appel à l'aide intégrée à R en passant le nom de la fonction (entre guillemets) à la fonction `help()`.

```r
help("mean")
```

On peut aussi utiliser le raccourci `?mean`.


```r
?mean
```


Ces deux commandes affichent une page (en anglais) décrivant la fonction, ses paramètres, son résultat, le tout accompagné de diverses notes, références et exemples. Ces pages d'aide contiennent à peu près tout ce que vous pourrez chercher à savoir, mais elles ne sont pas toujours d'une lecture aisée.

---

### Regrouper ses commandes dans des scripts

- Jusqu'ici on a utilisé R de manière “interactive”, en saisissant des commandes directement dans la console. Ce n'est pas très pratique pour sauvegarder son travail. De lorsque R ou RStudio redémarre, tout ce qui a été effectué dans la console est perdu.


- On va plutôt  regrouper les commandes dans des scripts (de simples fichiers texte), qui vont garder une trace de toutes les opérations effectuées. En rouvrant les scripts et en réexécutant les commandes qu'ils contiennent on pourra “reproduire” le chargement des données, leur traitement, les analyses et leurs résultats.

- Pour créer un script, il suffit de sélectionner le menu File, puis New file et R script. Une quatrième zone apparaît alors en haut à gauche de l'interface de RStudio. On peut enregistrer notre script à tout moment dans un fichier avec l'extension .R, en cliquant sur l'icône de disquette ou en choisissant File puis Save.

- Un script est un fichier texte brut, qui s'édite de la manière habituelle. À la différence de la console, quand on appuie sur Entrée, cela n'exécute pas la commande en cours mais insère un saut de ligne.


- Pour exécuter une commande dans un script, il faut positionner le curseur sur la ligne de la commande en question, et de cliquer sur le bouton Run dans la barre d'outils juste au-dessus de la zone d'édition du script. On peut aussi utiliser le raccourci clavier Ctrl + Entrée (Cmd + Entrée sous Mac). On peut aussi sélectionner plusieurs lignes avec la souris ou le clavier et cliquer sur Run (ou utiliser le raccourci clavier), et l'ensemble des lignes est exécuté d'un coup.

---

Au final, un script pourra ressembler à quelque chose comme ça :


```r
tailles &lt;- c(156, 164, 197, 147, 173)
poids &lt;- c(45, 59, 110, 44, 88)

mean(tailles)
mean(poids)

imc &lt;- poids / (tailles / 100) ^ 2
min(imc)
max(imc)
```

---
### Commentaires

Les commentaires sont un élément très important d'un script. Il s'agit de texte, ignoré par R, et qui permet de décrire les étapes du script, sa logique, les raisons pour lesquelles on a procédé de telle ou telle manière… Il est primordial de documenter ses scripts avec des commentaires, car il est très facile de ne plus se retrouver dans un programme qu'on a produit soi-même, même après une courte interruption.

Pour ajouter un commentaire, il suffit de le faire précéder d'un ou plusieurs symboles `#`. En effet, dès que R rencontre ce caractère, il ignore tout ce qui se trouve derrière, jussqu'à la fin de la ligne.

On peut donc documenter le script précédent :


```r
# Saisie des tailles et poids des enquêtés
tailles &lt;- c(156, 164, 197, 147, 173)
poids &lt;- c(45, 59, 110, 44, 88)

# Calcul des tailles et poids moyens
mean(tailles)
mean(poids)

# Calcul de l'IMC (poids en kilo divisé par les tailles en mètre au carré)
imc &lt;- poids / (tailles / 100) ^ 2
# Valeurs extrêmes de l'IMC
min(imc)
max(imc)
```

---

## Installer et charger des extensions (packages)

- L'installation de base de R permet de faire énormément de choses, mais le langage dispose en plus d'un système d'extensions permettant d'ajouter facilement de nouvelles fonctionnalités. La plupart des extensions sont développées et maintenues par la communauté des utilisateurs et utilisatrices de R, et diffusées via un réseau de serveurs nommé CRAN (Comprehensive R Archive Network).

- Pour installer une extension, si on dispose d'une connexion Internet, on peut 
    - Cliquer sur le bouton Install de l'onglet Packages de RStudio.
    - Il suffit alors d'indiquer le nom de l'extension dans le champ Package et de cliquer sur Install.
    
- On peut aussi installer des extensions en utilisant la fonction `install.packages()` directement dans la console. Par exemple, pour installer le package `ggplot2` on peut exécuter la commande    


```r
install.packages(ggplot2)
```
---

- Une fois l'extension installée, il faut la “charger” avant de pouvoir utiliser les fonctions qu'elle propose. Ceci se fait avec la fonction `library()`. Par exemple, pour pouvoir utiliser les fonctions de `ggplot2`, vous devrez exécuter la commande suivante :


```r
library(ggplot2)
```

Ainsi, on regroupe en général en début de script toute une série de commandes `library()` qui permettent de charger tous les packages utilisés dans le script. Quelque chose comme 


```r
library(ggplot2)
library(haven)
library(tidyr)
```

---
## Exercices

###Exercice 1

Construire le vecteur x suivant :


```
## [1] 120 134 256  12
```

Utiliser ce vecteur x pour générer les deux vecteurs suivants :

```
## [1] 220 234 356 112
```

```
## [1] 240 268 512  24
```

---

### Exercice 2

On a demandé à 4 ménages le revenu des deux conjoints, et le nombre de personnes du ménage :


```r
conjoint1 &lt;- c(1200, 1180, 1750, 2100)
conjoint2 &lt;- c(1450, 1870, 1690, 0)
nb_personnes &lt;- c(4, 2, 3, 2)
```

Calculer le revenu total de chaque ménage, puis diviser par le nombre de personnes pour obtenir le revenu par personne de chaque ménage.

--

### Exercice 3

Dans l'exercice précédent, calculer le revenu minimum et maximum parmi ceux du premier conjoint.

```r
conjoint1 &lt;- c(1200, 1180, 1750, 2100)
```

Recommencer avec les revenus suivants, parmi lesquels l'un des enquêtés n'a pas voulu répondre :


```r
conjoint1 &lt;- c(1200, 1180, 1750, NA)
```

---
### Exercice 4

Les deux vecteurs suivants représentent les précipitations (en mm) et la température (en °C) moyennes pour chaque mois de l'année pour la ville de Lyon (moyennes calculées sur la période 1981-2010) :


```r
temperature &lt;- c(3.4, 4.8, 8.4, 11.4, 15.8, 19.4, 22.2, 21.6, 17.6, 13.4, 7.6, 4.4)
precipitations &lt;- c(47.2, 44.1, 50.4, 74.9, 90.8, 75.6, 63.7, 62, 87.5, 98.6, 81.9, 55.2)
```

Calculer la température moyenne sur l’année.

Calculer la quantité totale de précipitations sur l’année.

À quoi correspond et comment peut-on interpréter le résultat de la fonction suivante ? Vous pouvez vous aider de la page d’aide de la fonction si nécessaire.


```r
cumsum(precipitations)
```

```
##  [1]  47.2  91.3 141.7 216.6 307.4 383.0 446.7 508.7 596.2 694.8 776.7 831.9
```

Même question pour :

```r
diff(temperature)
```

```
##  [1]  1.4  3.6  3.0  4.4  3.6  2.8 -0.6 -4.0 -4.2 -5.8 -3.2
```

---
### Exercice 5

On a relevé les notes en maths, anglais et sport d'une classe de 6 élèves et on a stocké ces données dans trois vecteurs :


```r
maths &lt;- c(12, 16, 8, 18, 6, 10)
anglais &lt;- c(14, 9, 13, 15, 17, 11)
sport &lt;- c(18, 11, 14, 10, 8, 12)
```

Calculer la moyenne des élèves de la classe en anglais.

Calculer la moyenne générale de chaque élève (la moyenne des ses notes dans les trois matières).


Essayez de comprendre le résultat des deux fonctions suivantes (vous pouvez vous aider de la page d’aide de ces fonctions) :

```r
pmin(maths, anglais, sport)
```

```
## [1] 12  9  8 10  6 10
```

```r
pmax(maths, anglais, sport)
```

```
## [1] 18 16 14 18 17 12
```


---
class: inverse

# Premier travail avec les données

---
class: left, top

## Données d'exemple

Nous utiliserons dans ce cours des données issues de l'INSEE : la base "[Histoires de vie 2003](https://www.insee.fr/fr/statistiques/2532244)"

La base est disponible au format `.csv` à l'adresse suivante [https://raw.githubusercontent.com/P8EcoGe/rl3/main/bases/hdv3.csv](https://raw.githubusercontent.com/P8EcoGe/rl3/main/bases/hdv3.csv)

Vous pouvez la charger directement dans `R` à l'aide de la commande `read.csv()`. On va la placer dans un objet nommé `hv3` : 


```r
hv3 &lt;- read.csv("https://raw.githubusercontent.com/P8EcoGe/rl3/main/bases/hdv3.csv")
```

Alternativement, vous pouvez enregistrer le fichier sur votre disque dur, puis le charger dans `R` avec 


```r
hv3 &lt;- read.csv("chemin_vers_le_fichier/hdv3.csv")
```

Vous pouvez voir dans l'onglet "Environment" que la base de donnée comprend 2000 observations, et 21 variables 


Si vous souhaitez voir le contenu de la base, vous pouvez utiliser la commande `View()` : 

```r
View(hv3)
```


---

## Structure de la base

Un tableau étant un objet comme un autre, on peut lui appliquer des fonctions. Par exemple, `nrow()` et `ncol()` retournent le nombre de lignes et de colonnes du tableau. `dim()` renvoie les deux


```r
nrow(hv3)
```

```
## [1] 2000
```

```r
ncol(hv3)
```

```
## [1] 20
```

```r
dim(hv3)
```

```
## [1] 2000   20
```

La fonction `names()` retourne les noms des colonnes du tableau, c'est-à-dire la liste de nos variables


```r
names(hv3)
```

```
##  [1] "id"            "age"           "sexe"          "nivetud"       "poids"         "occup"         "qualif"        "freres.soeurs"
##  [9] "clso"          "relig"         "trav.imp"      "trav.satisf"   "hard.rock"     "lecture.bd"    "peche.chasse"  "cuisine"      
## [17] "bricol"        "cinema"        "sport"         "heures.tv"
```

---
Enfin, la fonction `str()` renvoie un descriptif plus détaillé de la structure du tableau. Elle liste les différentes variables, indique leur type et affiche les premières valeurs.


```r
str(hv3)
```

```
## 'data.frame':	2000 obs. of  20 variables:
##  $ id           : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ age          : int  28 23 59 34 71 35 60 47 20 28 ...
##  $ sexe         : chr  "Femme" "Femme" "Homme" "Homme" ...
##  $ nivetud      : chr  "Enseignement superieur y compris technique superieur" NA "Derniere annee d'etudes primaires" "Enseignement superieur y compris technique superieur" ...
##  $ poids        : num  2634 9738 3994 5732 4329 ...
##  $ occup        : chr  "Exerce une profession" "Etudiant, eleve" "Exerce une profession" "Exerce une profession" ...
##  $ qualif       : chr  "Employe" NA "Technicien" "Technicien" ...
##  $ freres.soeurs: int  8 2 2 1 0 5 1 5 4 2 ...
##  $ clso         : chr  "Oui" "Oui" "Non" "Non" ...
##  $ relig        : chr  "Ni croyance ni appartenance" "Ni croyance ni appartenance" "Ni croyance ni appartenance" "Appartenance sans pratique" ...
##  $ trav.imp     : chr  "Peu important" NA "Aussi important que le reste" "Moins important que le reste" ...
##  $ trav.satisf  : chr  "Insatisfaction" NA "Equilibre" "Satisfaction" ...
##  $ hard.rock    : chr  "Non" "Non" "Non" "Non" ...
##  $ lecture.bd   : chr  "Non" "Non" "Non" "Non" ...
##  $ peche.chasse : chr  "Non" "Non" "Non" "Non" ...
##  $ cuisine      : chr  "Oui" "Non" "Non" "Oui" ...
##  $ bricol       : chr  "Non" "Non" "Non" "Oui" ...
##  $ cinema       : chr  "Non" "Oui" "Non" "Oui" ...
##  $ sport        : chr  "Non" "Oui" "Oui" "Oui" ...
##  $ heures.tv    : num  0 1 0 2 3 2 2.9 1 2 2 ...
```

---

## Accéder aux variables, et en créer de nouvelles

On se réfère aux variables à l'aide de l'opérateur `$`, qui permet d'accéder aux colonnes du tableau. On utilisera la syntaxe `nom_de_la_base$nom_de_la_variable` pour désigner une variable particulière d'une base de données.

Par exemple, on peut utiliser la fonction `head()` pour afficher les premières valeurs de la variable `age` de la base stockée dans l'objet `hv3`


```r
head(hv3$age)
```

```
## [1] 28 23 59 34 71 35
```

On peut aussi utiliser l’opérateur `$` pour créer une nouvelle variable dans notre base : pour cela, il suffit de lui assigner une valeur.

Par exemple, la variable `heures.tv` contient le nombre d'heures passées quotidiennement devant la télé.


```r
head(hv3$heures.tv)
```

```
## [1] 0 1 0 2 3 2
```

---
On peut vouloir créer une nouvelle variable dans notre tableau qui contienne la même durée convertie en minutes. 

On va donc créer une nouvelle variables `minutes.tv` de la manière suivante 


```r
hv3$minutes.tv &lt;- hv3$heures.tv * 60
```

On peut alors constater, qu'une nouvelle variable (une nouvelle colonne) a bien été ajoutée à la base de données.


```r
head(hv3$minutes.tv)
```

```
## [1]   0  60   0 120 180 120
```

---
## Analyse univariée

### Variable quantitative

Une variable quantitative est une variable de type numérique (un nombre) qui peut prendre un grand nombre de valeurs. On en a plusieurs dans notre jeu de données, notamment l'âge (variable `age`) ou le nombre d'heures passées devant la télé (`heures.tv`).


#### Indicateurs numériques
Pour obtenir un résumé numérique concis d'une variable numérique, on peut utiliser la commande `summary()` : 


```r
summary(hv3$heures.tv)
```

```
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##   0.000   1.000   2.000   2.247   3.000  12.000       5
```

```r
summary(hv3$age)
```

```
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   18.00   35.00   48.00   48.16   60.00   97.00
```

`summary()` donne le minimum, le maximum, la moyenne, les premier second (médiane) et troisième quartile de la distribution. La dernière valeur donne, s'il y en a, le nombre de valeurs manquantes (`NA`) pour la variable. 



---

On peut également obtenir (et, si on le souhaite, sauver dans un objet) les valeurs de chaque élément avec les fonction `min()`, `max()`, `median()`, `mean()` et `quantile()` : 


```r
min(hv3$age)
```

```
## [1] 18
```

```r
max(hv3$age)
```

```
## [1] 97
```

```r
mean(hv3$age)
```

```
## [1] 48.157
```

```r
median(hv3$age)
```

```
## [1] 48
```

```r
quantile(hv3$age,prob=0.75) # l'option "Prob=" permet de préciser le quantile souhaité
```

```
## 75% 
##  60
```

---

Si la variable examinée contient des valeurs manquante, il convient d'inclure l'option `na.rm=TRUE` dans l'appel de la fonction : 


```r
mean(hv3$heures.tv)
```

```
## [1] NA
```

```r
mean(hv3$heures.tv, na.rm=TRUE)
```

```
## [1] 2.246566
```

On peut obtenir des indicateurs de dispersion (variance, écart-type) à l'aide des commandes `var()` et `sd()` : 




```r
var(hv3$age)
```

```
## [1] 287.0249
```

```r
sd(hv3$age)
```

```
## [1] 16.94181
```

---

#### Représentation graphique

La représentation graphique la plus courante pour présenter la distribution d'une variable quantitative continue est l'histogramme, que l'on obtient à l'aide de la commande `hist()`

.pull-left[

```r
library(ggplot2)

ggplot(hv3, aes(x=age)) +
  geom_histogram()
```

```r
# hist(hv3$age)
```
]

.pull-right[
&lt;img src="slidesrl3_files/figure-html/code-first-1.png" width="400px" /&gt;
]

---
.pull-left[

```r
# library(ggplot2)


hist(hv3$age)
```
]

.pull-right[
&lt;img src="slidesrl3_files/figure-html/code-sec-1.png" width="400px" /&gt;
]

---

.pull-left[

```r
hist(hv3$age, breaks=10)
```
]

.pull-right[
&lt;img src="slidesrl3_files/figure-html/code-second-1.png" width="300px" /&gt;
]

.pull-left[

```r
hist(hv3$age, col = "skyblue",
     main = "Répartition des âges des enquêtés",
     xlab = "Âge",
     ylab = "Effectif",
     breaks = 30)
```
]

.pull-right[
&lt;img src="slidesrl3_files/figure-html/code-trois-1.png" width="300px" /&gt;
]
---
Une autre représentation classique est la "Boîte à moustache", que l'on obtient avec la commande `boxplot()` : 

.pull-left[

```r
boxplot(hv3$age)
```
]

.pull-right[
&lt;img src="slidesrl3_files/figure-html/box1-1.png" width="250px" /&gt;
]

.pull-left[

```r
boxplot(hv3$age~hv3$sport,   # La syntaxe y~x permet de représenter la distribution de y pour chaque valeur de x
        col=c("gold","darkgreen"),
        xlab="Pratique d'un sport", ylab="Âge"
        ) 
```
]

.pull-right[
&lt;img src="slidesrl3_files/figure-html/box2-1.png" width="250px" /&gt;
]


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
